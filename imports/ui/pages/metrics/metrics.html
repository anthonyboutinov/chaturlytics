<template name="Page_metrics">

  <div class="level">
    <div class="level-left">
      <div class="level-item">
        <h3 class="title">Metrics</h3>
      </div>
    </div>
    <div class="level-right">

      <div class="level-item">
        <button class="button toggle-display-notes">
          {{#unless displayNotes}}
            <span class="icon is-small">
              <i class="fas fa-fw fa-toggle-off" aria-hidden="true"></i>
            </span>
          {{else}}
            <span class="icon is-small">
              <i class="fas fa-fw fa-toggle-on" aria-hidden="true"></i>
            </span>
          {{/unless}}
          <span> Notes</span>
        </button>
      </div>

      {{#if skipOffDaysToggleApplicable}}
        <div class="level-item">
          <button class="button toggle-skip-offdays">
            {{#if skipOffDays}}
              <span class="icon is-small">
                <i class="fas fa-fw fa-toggle-off" aria-hidden="true"></i>
              </span>
            {{else}}
              <span class="icon is-small">
                <i class="fas fa-fw fa-toggle-on" aria-hidden="true"></i>
              </span>
            {{/if}}
            <span> Off-days</span>
          </button>
        </div>
      {{/if}}

      <div class="level-item">
        <div class="dropdown is-hoverable is-right">
          <div class="dropdown-trigger">
            <button class="button" aria-haspopup="true" aria-controls="dropdown-menu-metrics">
              <span>{{groupingLabel grouping}}</span>
              <span class="icon is-small">
                <i class="fas fa-angle-down" aria-hidden="true"></i>
              </span>
            </button>
          </div>
          <div class="dropdown-menu" role="menu" id="dropdown-menu-metrics">
            <div class="dropdown-content">
              <div class="dropdown-item"><p class="menu-label">Change grouping</p></div>
              <hr class="dropdown-divider">
              {{#each groupingOptions}}
                <a class="dropdown-item {{isActiveByEquals grouping this}} set-grouping" href="#">{{groupingLabel this}}</a>
              {{/each}}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="box">
    Charts: 1.1) Broadcasts count / density, 1.2) time online dnesity, 2) income dneisty, 3.1) followers density, 3.2) viewers density
    </div>

  <table class="table is-fullwidth is-size-7">
    <thead>
      <tr>
        <th>Timeframe</th>
        <th>Broadcasts</th>
        <th>Number of<br>Broadcasts</th>
        <th>Time<br>Online</th>
        <th>Followers</th>
        <th> Income, TKN </th>
        <th> Average<br>Income per<br>Hour During<br>Broadcasts, TKN </th>
        <!-- <th>Extra Income</th> -->
        <!-- <th>Total Income per Day, <div class="tag is-small is-light"><i class="fas fa-fw fa-chevron-down has-text-grey-light"></i> RUB</div></th> -->
        {{#if displayNotes}}<th style="width: 25vw;">Notes</th>{{/if}}
      </tr>
    </thead>
    <tfoot>
    </tfoot>
    <tbody>
      {{#each metrics}}
        <tr class="{{rowClasses}}">
          <th class="{{rowClasses}}">{{timeframe}}</th>
          <td>
            {{#if moreThanOneSession}}
              {{#each sessions}}
                <div class="dropdown is-hoverable">
                  <div class="dropdown-trigger" aria-haspopup="true" aria-controls="dropdown-menu-session-{{@index}}">
                    <a href="/view/sessions/{{_id}}">
                      <div class="tag" style="margin-bottom:0.5em;">{{sessionIndex @index}}</div>
                    </a>
                  </div>
                  <div class="dropdown-menu is-wide" role="menu" id="dropdown-menu-session-{{@index}}">
                    <div class="dropdown-content">
                      <div class="dropdown-item"><p class="menu-label">Broadcast {{sessionIndex @index}}</p></div>
                      <div class="dropdown-item">
                        <p class="has-text-weight-bold">{{timeframeForSession}}</p>
                      </div>
                      <div class="dropdown-item">
                        <p class="has-text-weight-semibold">{{duration}}</p>
                        <p class="has-text-weight-semibold">{{deltaTokens}} TKN</p>
                      </div>
                      {{#if note}}
                        <div class="dropdown-item">
                          <p class="has-text-grey">{{note}}</p>
                        </div>
                      {{/if}}
                      <hr class="dropdown-divider">
                      <a class="dropdown-item" href="/view/sessions/{{_id}}">
                        <i class="fas fa-fw fa-info-circle"></i>
                        Go to broadcast
                      </a>
                    </div>
                  </div>
                </div>
              {{/each}}
            {{else}}
              {{#each sessions}}
                <a href="/view/sessions/{{_id}}">
                  <div class="tag">Go to broadcast</div>
                </a>
              {{/each}}
            {{/if}}
          </td>
          <td class="has-text-right">{{numBroadcasts}}</td>
          <td class="has-text-right">{{timeOnline}}</td>
          <td class="has-text-right">{{deltaFollowers}}</td>
          <td class="has-text-right" style="{{deltaTokensStyle}}">{{deltaTokens}}</td>
          <td class="has-text-right" style="{{avgTokensStyle}}">{{avgTokens}}</td>
          <!-- <td class="has-text-right">N/I</td> -->
          <!-- <td class="has-text-right">N/I</td> -->
          {{#if displayNotes}}<td class="has-text-right">{{notes}}</td>{{/if}}
        </tr>
      {{/each}}
    </tbody>
  </table>

</template>
